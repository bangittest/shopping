<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Sumire Store</title>
</head>
<body>

<section>
	<div class="container mt-5 pt-5 mb-5">
		<div class="card shadow-lg p-4 rounded-4 border-0">
			<div class="row g-4 align-items-center">



				<!-- H√¨nh ·∫£nh s·∫£n ph·∫©m -->
				<div class="col-md-6 text-center">
					<img th:src="@{|/img/product_img/${product.image}|}"
						 class="img-fluid rounded shadow-sm border"
						 style="max-height: 350px; object-fit: contain;" alt="product">
				</div>

				<!-- Th√¥ng tin s·∫£n ph·∫©m -->
				<div class="col-md-6">
					<h2 class="mb-3 fw-semibold">[[${product.title}]]</h2>
					<p><strong>M√¥ t·∫£:</strong><br>[[${product.description}]]</p>

					<p class="mb-2">
						<strong>Tr·∫°ng th√°i:</strong>
						<th:block th:if="${product.stock > 0}">
							<span class="badge bg-success">C√≤n h√†ng</span>
						</th:block>
						<th:block th:unless="${product.stock > 0}">
							<span class="badge bg-secondary">H·∫øt h√†ng</span>
						</th:block>
					</p>

					<p class="mb-2"><strong>Danh m·ª•c:</strong> [[${product.category}]]</p>
					<p class="mb-4"><strong>Ch√≠nh s√°ch:</strong> ƒê·ªïi/tr·∫£ trong 7 ng√†y</p>

					<h4 class="text-danger mb-3">
						<small  th:text="${#numbers.formatDecimal(product.discountPrice, 0, 'COMMA', 0, 'POINT') + ' ƒë'}"></small>
<!--						[[${product.discountPrice}]]‚Ç´-->
						<small class="text-decoration-line-through text-muted ms-2" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + ' ƒë'}"></small>
						<small class="text-success ms-2" >[[${product.discount}]]% gi·∫£m</small>
					</h4>

					<!-- Icon th√¥ng tin -->
					<div class="row text-center mb-4">
						<div class="col">
							<i class="fas fa-money-bill-wave fa-lg text-success mb-2"></i>
							<p class="small">COD</p>
						</div>
						<div class="col">
							<i class="fas fa-undo-alt fa-lg text-danger mb-2"></i>
							<p class="small">ƒê·ªïi tr·∫£</p>
						</div>
						<div class="col">
							<i class="fas fa-truck-moving fa-lg text-primary mb-2"></i>
							<p class="small">Mi·ªÖn ph√≠ giao</p>
						</div>
					</div>

					<!-- N√∫t Add to Cart -->
					<th:block th:if="${product.stock > 0}">
						<th:block th:if="${user != null}">
							<button class="btn btn-danger w-100 py-2"
									id="addToCartBtn"
									th:data-pid="${product.id}"
									th:data-uid="${user.id}">
								üõí Th√™m v√†o gi·ªè
							</button>
						</th:block>
						<th:block th:unless="${user != null}">
							<a href="/signin" class="btn btn-danger w-100 py-2">üõí Th√™m v√†o gi·ªè</a>
						</th:block>
					</th:block>

					<th:block th:unless="${product.stock > 0}">
						<button class="btn btn-secondary w-100 py-2" disabled>H·∫øt h√†ng</button>
					</th:block>
				</div>
			</div>
		</div>
	</div>
</section>



</body>
</html>

<script>
	$(document).ready(function () {
		$('#addToCartBtn').click(function () {
			const pid = $(this).data('pid');
			const uid = $(this).data('uid');

			$.ajax({
				url: '/user/addCart',
				method: 'POST',
				data: {
					pid: pid,
					uid: uid
				},
				success: function () {
					alert('‚úÖ S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!');
					// C√≥ th·ªÉ reload gi·ªè ho·∫∑c c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng n·∫øu mu·ªën
					// location.reload(); ho·∫∑c c·∫≠p nh·∫≠t DOM
					location.reload();
				},
				error: function () {
					alert('‚ùå L·ªói khi th√™m v√†o gi·ªè h√†ng. Vui l√≤ng th·ª≠ l·∫°i!');
				}
			});
		});
	});
</script>
